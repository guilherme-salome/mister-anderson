{% extends "base.html" %}

{% block title %}User Administration{% endblock %}

{% block page_heading %}
  <div class="top-bar__content">
    <button class="icon-button icon-button--ghost" onclick="window.history.back()" aria-label="Go back">‚Üê</button>
    <div>
      <h1 class="top-bar__title">User administration</h1>
      <p class="top-bar__subtitle">Manage access and credentials.</p>
    </div>
  </div>
{% endblock %}

{% block content %}
  <nav class="section-tabs" aria-label="Admin sections">
    <a href="#accounts" class="section-tabs__item">Accounts</a>
    <a href="#create-user" class="section-tabs__item">Create</a>
    <a href="#update-role" class="section-tabs__item">Roles</a>
    <a href="#reset-password" class="section-tabs__item">Reset</a>
  </nav>

  <section class="card-list" id="accounts">
    {% for u in users %}
      <article class="data-card">
        <header class="data-card__header">
          <h2 class="data-card__title">{{ u.full_name or u.username }}</h2>
          <span class="data-card__meta">Created {{ u.created_at }}</span>
        </header>
        <dl class="data-card__details">
          <div>
            <dt>Username</dt>
            <dd>{{ u.username }}</dd>
          </div>
          <div>
            <dt>Role</dt>
            <dd>{{ u.role|capitalize }}</dd>
          </div>
          <div>
            <dt>Status</dt>
            <dd>{{ 'Active' if u.is_active else 'Inactive' }}</dd>
          </div>
        </dl>
        {% if u.id != user.id %}
          <footer class="data-card__footer">
            <form method="post"
                  action="/admin/users/status"
                  class="form form--inline">
              <input type="hidden" name="target_user" value="{{ u.username }}">
              <input type="hidden" name="new_status" value="{{ 0 if u.is_active else 1 }}">
              <button type="submit" class="button button--secondary button--block">
                {{ 'Deactivate' if u.is_active else 'Activate' }}
              </button>
            </form>
          </footer>
        {% endif %}
      </article>
    {% endfor %}
  </section>

  <section class="card card--inset" id="create-user">
    <h2 class="section-title">Create user</h2>
    <form method="post" action="/admin/users/create" class="form form--stacked">
      <div class="form-field">
        <label for="new_username">Username</label>
        <input type="text" id="new_username" name="new_username" placeholder="e.g. employee1" required autocomplete="username">
      </div>
      <div class="form-field">
        <label for="full_name">Full name</label>
        <input type="text" id="full_name" name="full_name" placeholder="Full name" required>
      </div>
      <div class="form-field">
        <label for="role">Role</label>
        <select id="role" name="role" required>
          {% for role in roles %}
            <option value="{{ role }}">{{ role|capitalize }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-field">
        <label for="account_status">Status</label>
        <select id="account_status" name="account_status" required>
          <option value="active" selected>Active</option>
          <option value="inactive">Inactive</option>
        </select>
      </div>
      <div class="form-field">
        <label for="temp_password">Temporary password</label>
        <input type="password" id="temp_password" name="temp_password" minlength="8" placeholder="At least 8 characters" required autocomplete="new-password">
      </div>
      <div class="form-actions">
        <button type="submit" class="button button--primary button--block">Create user</button>
      </div>
    </form>
  </section>

  <section class="card card--inset" id="update-role">
    <h2 class="section-title">Update role</h2>
    <form method="post" action="/admin/users/role" class="form form--stacked">
      <div class="form-field">
        <label for="role_username">Username</label>
        <input type="text" id="role_username" name="role_username" placeholder="e.g. employee1" required>
      </div>
      <div class="form-field">
        <label for="new_role">New role</label>
        <select id="new_role" name="new_role" required>
          {% for role in roles %}
            <option value="{{ role }}">{{ role|capitalize }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-actions">
        <button type="submit" class="button button--primary button--block">Change role</button>
      </div>
    </form>
  </section>

  <section class="card card--inset" id="reset-password">
    <h2 class="section-title">Reset password</h2>
    <p class="form-help">Set a new password (minimum 8 characters) for any user.</p>
    <form method="post" action="/admin/users/reset" class="form form--stacked">
      <div class="form-field">
        <label for="target_username">Username</label>
        <input type="text" id="target_username" name="target_username" placeholder="e.g. employee1" required autocomplete="username">
      </div>
      <div class="form-field">
        <label for="new_password">New password</label>
        <input type="password" id="new_password" name="new_password" minlength="8" required autocomplete="new-password">
      </div>
      <div class="form-field">
        <label for="confirm_password">Confirm password</label>
        <input type="password" id="confirm_password" name="confirm_password" minlength="8" required autocomplete="new-password">
      </div>
      <div class="form-actions">
        <button type="submit" class="button button--primary button--block">Update password</button>
      </div>
    </form>
  </section>
{% endblock %}
