{% extends "base.html" %}

{% block title %}Pickups{% endblock %}

{% block page_heading %}
  <div class="top-bar__content">
    <h1 class="top-bar__title">Pickups</h1>
    <p class="top-bar__subtitle">Search and review pickup numbers on the floor.</p>
  </div>
{% endblock %}

{% block content %}
  <section class="card card--inset">
    <p class="section-lede">Search for a pickup number to review pallets or continue capturing products.</p>
    <form method="get" action="/pickups" class="form form--stacked">
      <div class="form-field">
        <label for="pickup_query">Pickup number</label>
        <input type="number"
               id="pickup_query"
               name="q"
               value="{{ query or '' }}"
               placeholder="Enter pickup number"
               inputmode="numeric">
      </div>
      <div class="form-actions">
        <button type="submit" class="button button--primary button--block">Search</button>
        {% if query %}
          <a href="/pickups" class="button button--secondary button--block">Clear</a>
        {% endif %}
      </div>
    </form>
    <p class="form-help">
      Pickup creation remains in the external workflow. Use this list to review pallets and add products.
    </p>
  </section>

  <section class="card-list">
    {% for p in pickups %}
      <article class="data-card">
        <header class="data-card__header">
          <h2 class="data-card__title">Pickup <span>#{{ p.PICKUP_NUMBER }}</span></h2>
          <span class="data-card__meta">Updated {{ p.DT_UPDATE or "‚Äî" }}</span>
        </header>
        <dl class="data-card__details">
          <div>
            <dt>Total pallets</dt>
            <dd>{{ p.TOTAL_PALLETS or 0 }}</dd>
          </div>
        </dl>
        <footer class="data-card__footer">
          <a class="button button--secondary button--block" href="/pickups/{{ p.PICKUP_NUMBER }}">
            Open pickup
          </a>
        </footer>
      </article>
    {% else %}
      <p class="empty-state">No pickup data available.</p>
    {% endfor %}
  </section>
  {% if total_pages > 1 %}
    <nav class="pagination-bar" aria-label="Pagination">
      {% if has_prev %}
        <a href="/pickups?page={{ page - 1 }}{% if query %}&amp;q={{ query }}{% endif %}" class="pagination-bar__button">‚Äπ Prev</a>
      {% else %}
        <span class="pagination-bar__button is-disabled">‚Äπ Prev</span>
      {% endif %}

      <span class="pagination-bar__info">Page {{ page }} of {{ total_pages }}</span>

      {% if has_next %}
        <a href="/pickups?page={{ page + 1 }}{% if query %}&amp;q={{ query }}{% endif %}" class="pagination-bar__button">Next ‚Ä∫</a>
      {% else %}
        <span class="pagination-bar__button is-disabled">Next ‚Ä∫</span>
      {% endif %}
    </nav>
  {% endif %}
{% endblock %}

{% block floating_action %}
  {% if user.role in ("employee", "supervisor", "admin") %}
    <a href="/pickups?q={{ query or '' }}" class="fab" aria-label="Find pickup">üîç</a>
  {% endif %}
{% endblock %}

{% block scripts %}
  {{ super() }}
{% endblock %}
